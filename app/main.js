(()=>{"use strict";function t(t){let i=t.clientX-this.canvas.width/2-15,s=t.clientY-this.canvas.height/2-15;this.player.calculateRotate(i,s)}function i(t){switch(t.buttons){case 1:if(!this.config.clickDisable)return;this.config.clickDisable&&this.player.shoot(),this.config.clickDisable=!1,this.clickPosibleTimer()}}async function s(){return await new Promise((t=>{setTimeout((()=>t(this.config.clickDisable=!0)),200)}))}function e(t){if(this.x.current<innerWidth/2+30&&this.x.current>innerWidth/2-30&&this.y.current<innerHeight/2+30&&this.y.current>innerHeight/2-30)return"stop";let i;return t&&t.find((t=>(i=t.index,t.x<=this.x.current+this.size&&t.x>this.x.current-this.size&&t.y>=this.y.current-this.size&&t.y<this.y.current+this.size)))?{bulletIndex:i,fragIndex:this.index}:void 0}function n(){const t=Math.round(Math.random()*innerWidth),i=Math.round(Math.random()*innerHeight);if(t>innerWidth/2-100&&t<innerWidth/2+100||i>innerHeight/2-100&&i<innerHeight/2+100)return void this.init();this.x.start=t,this.y.start=i,this.size=Math.round(13*Math.random()+7);let s=innerWidth/2-15-this.x.start,e=innerHeight/2-15-this.y.start;this.angleMove=e/s,this.dir.x=this.x.start>innerWidth/2?-1:1,this.dir.y=this.y.start>innerHeight/2?-1:1,this.draw()}function h(t){return this.moveCalculate(),this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.arc(this.x.current,this.y.current,this.size,0,2*Math.PI),this.ctx.fill(),this.timeToCollisionPlayer++,this.collision(t)}function r(){const t=Math.pow(this.angleMove,2);let i=Math.sqrt(1/(1+t)),s=Math.sqrt(t/(t+1));this.x.current=this.x.start+this.dir.x*(this.velocity*i*this.timeToCollisionPlayer),this.y.current=this.y.start+this.dir.y*(this.velocity*s*this.timeToCollisionPlayer)}function o(t){this.index=t}const l=class{constructor(t,i){this.x={start:null,current:null},this.y={start:null,current:null},this.index=i,this.angleMove=0,this.velocity=2,this.size=20,this.timeToCollisionPlayer=0,this.ctx=t,this.dir={},this.color="#99d",this.collision=e.bind(this),this.init=n.bind(this),this.draw=h.bind(this),this.moveCalculate=r.bind(this),this.setNewIndex=o.bind(this),this.init()}};function a(){const{x:t,y:i}=this;this.ctx.fillStyle=this.color,this.ctx.translate(innerWidth/2,innerHeight/2),this.ctx.rotate(this.currentAngleRotate),this.ctx.fillRect(t,i,this.playerSize,this.playerSize),this.ctx.beginPath(),this.ctx.moveTo(this.playerSize/2+2,-8),this.ctx.lineTo(this.playerSize/2+10,0),this.ctx.lineTo(this.playerSize/2+2,8),this.ctx.closePath(),this.ctx.lineWidth=5,this.ctx.fillStyle="#483d8b",this.ctx.strokeStyle="#fff",this.ctx.stroke(),this.ctx.fill(),this.ctx.setTransform(1,0,0,1,0,0)}function c(t,i){let s=Math.atan(i/t);(t<0&&i>0&&180*s/Math.PI<0||t<0&&i<0&&180*s/Math.PI<=90)&&(s=180+180*s/Math.PI,s*=Math.PI/180),this.currentAngleRotate=s}function d(){return this.bullets}function u(t){this.bullets.splice(t,1),this.bullets.forEach(((t,i)=>{t.setNewIndex(i)}))}function f(){return{x:this.x,y:this.y}}function x(){this.bulletClear(),this.ctx.fillStyle=this.color,this.x=window.innerWidth/2+Math.round(this.velocity*Math.cos(this.angleRotate)*this.lifeTime),this.y=window.innerHeight/2+Math.round(this.velocity*Math.sin(this.angleRotate)*this.lifeTime),this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.size,0,2*Math.PI),this.ctx.fill(),this.lifeTime++}function g(){(this.x>innerWidth||this.x<0||this.y>innerHeight||this.y<0)&&this.playerContext.bulletsModify(this.index)}function y(){return{i:this.index,x:this.x,y:this.y}}function v(t){this.index=t}function w(){const t=["#87CEEB","#D3D3D3","#FFE4B5","#00FFFF","#00FF7F","#CD5C5C","#CD661D"],i=t[Math.round(Math.random()*t.length)];this.bullets.push(new class{constructor(t,i,s,e,n){this.index=i,this.size=7,this.x=0,this.y=0,this.velocity=9,this.lifeTime=0,this.playerContext=s,this.angleRotate=e,this.color=n,this.draw=x.bind(this),this.bulletClear=g.bind(this),this.getCord=y.bind(this),this.setNewIndex=v.bind(this),this.ctx=t}}(this.ctx,this.bullets.length,this,this.currentAngleRotate,i))}function b(){this.config.play=!0,this.frags=[new l(this.ctx,0)],this.score=0,this.setCanvasSizes(),this.player=new class{constructor(t,i){this.ctx=t,this.color="#f00",this.playerSize=30,this.x=-this.playerSize/2,this.y=-this.playerSize/2,this.currentAngleRotate=0,this.gameContext=i,this.bullets=[],this.draw=a.bind(this),this.calculateRotate=c.bind(this),this.getBullets=d.bind(this),this.bulletsModify=u.bind(this),this.getCord=f.bind(this),this.shoot=w.bind(this),this.draw()}}(this.ctx,this.config.canvasWidth,this.config.canvasHeight,this),this.fragRespawnInterval=setInterval((()=>this.fragRespawn()),900),window.addEventListener("resize",(()=>this.setCanvasSizes())),window.addEventListener("mousedown",this.mousedownListener),window.addEventListener("mousemove",this.mousemoveListener),this.loop()}function m(t){if("stop"===t&&(this.config.play=!1),"object"==typeof t)return this.player.bulletsModify(t.bulletIndex),this.fragsModify(t),void this.score++}function p(){this.frags.push(new l(this.ctx,this.frags.length))}function M(){this.config.canvasWidth=this.canvas.width=window.innerWidth,this.config.canvasHeight=this.canvas.height=window.innerHeight}function S(){const t=localStorage.getItem("score")||0;let i=`\n        <div class="items-wrapper">\n            <div class="result">\n                <div class="top-score">top score: ${t}</div>\n                <div class="current-score">Your score: ${this.score}</div>\n            </div>\n\n            <div class="window-item" id="restart">restart</div>\n        </div>\n        \n    `,s=document.createElement("div");s.classList.add("window"),s.innerHTML=i,document.querySelector("body").prepend(s),document.querySelector("#restart").onclick=i=>{this.score>t&&localStorage.setItem("score",this.score),this.init(),s.remove()}}function C(){if(this.config.play)return this.draw(),void window.requestAnimationFrame((()=>this.loop()));this.clear(),clearInterval(this.fragRespawnInterval),this.player=null,this.frags=[],this.gameOverWindow(),window.removeEventListener("mousemove",this.mousemoveListener),window.removeEventListener("mousedown",this.mousedownListener)}function z(){this.clear(),this.ctx.fillStyle="#fff",this.ctx.font="italic 18px Arial",this.ctx.fillText(`Score: ${this.score}`,innerWidth-100,50),this.player.draw(),this.player.getBullets().length&&this.player.getBullets().map((t=>t.draw())),this.frags.length&&this.frags.map((t=>this.kill(t.draw(this.player.getBullets()))))}function I(){this.ctx.clearRect(0,0,this.config.canvasWidth,this.config.canvasHeight)}function W({fragIndex:t}){this.frags.splice(t,1),this.frags.forEach(((t,i)=>t.setNewIndex(i)))}new class{constructor(){this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.score=0,this.fragRespawnInterval=null,this.config={canvasWidth:null,canvasHeight:null,clickDisable:!0,play:!1},this.mousemoveListener=t.bind(this),this.mousedownListener=i.bind(this),this.draw=z.bind(this),this.clickPosibleTimer=s.bind(this),this.init=b.bind(this),this.kill=m.bind(this),this.fragRespawn=p.bind(this),this.setCanvasSizes=M.bind(this),this.gameOverWindow=S.bind(this),this.loop=C.bind(this),this.clear=I.bind(this),this.fragsModify=W.bind(this),this.init()}}})();